@model BestApp.Models.CreateRouteModel

@{
    ViewBag.Title = "Create Route";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Create Route</h2>

@Html.HiddenFor(Model => Model.startLatitude)
@Html.HiddenFor(Model => Model.startLongitude)
@Html.HiddenFor(Model => Model.stopLatitude)
@Html.HiddenFor(Model => Model.stopLongitude)

<div class="row" style="margin-top:50px">
    <div class="col-md-8">
        @Html.Partial("~/Views/Shared/DefaultMap.cshtml")
    </div>

    <div class="col-md-4">

        @using (Html.BeginForm())
        {
            
                                        <div class="row" style="margin-top:50px">
                                            <div class="col-md-6">
                                                @Html.LabelFor(Model => Model.Name)
                                            </div>
                                            <div class="col-md-6">
                                                @Html.EditorFor(Model => Model.Name)

                                            </div>
                                        </div>

                                        <div class="row" style="margin-top:50px">
                                            <div class="col-md-6">
                                                @Html.LabelFor(Model => Model.PhoneNumber)
                                            </div>
                                            <div class="col-md-6">
                                                @Html.EditorFor(Model => Model.PhoneNumber)
                                            </div>
                                        </div>

                                        <div class="row" style="margin-top:50px">
                                            <div class="col-md-6">
                                                @Html.LabelFor(Model => Model.Email)
                                            </div>
                                            <div class="col-md-6">
                                                @Html.EditorFor(Model => Model.Email)
                                            </div>
                                        </div>

                                        <div class="row" style="margin-top:50px">
                                            <div class="col-md-6">
                                                @Html.LabelFor(Model => Model.FreeSeats)
                                            </div>
                                            <div class="col-md-6">
                                                @Html.EditorFor(Model => Model.FreeSeats)
                                                <br /><br />
                                                <input type="submit" value="Create Route!" />
                                            </div>
                                        </div>
                                  @Html.ValidationSummary(){ }
        }

    </div>
</div>

<script src="@Url.Content("~/Scripts/jquery-1.5.1.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script type="text/javascript">

    var firstClick = false;
    var secondClick = false;
    var markerPlecare;
    var markerSosire;

    $(document).ready(function () {
        var onDragendPlecare = function (e) {
            $('#LatPlecare').val(markerPlecare._latlng.lat);
            $('#LongPlecare').val(markerPlecare._latlng.lng);
        }
        var onDragendSosire = function (e) {
            $('#LatSosire').val(markerSosire._latlng.lat);
            $('#LongSosire').val(markerSosire._latlng.lng);
        }

        var onClick = function (e) {
            if (!firstClick) {
                markerPlecare = L.marker([e.latlng.lat, e.latlng.lng], { draggable: true });
                markerPlecare.addTo(map);
                markerPlecare.on('dragend', onDragendPlecare);
                firstClick = true;
                $('#LatPlecare').val(e.latlng.lat);
                $('#LongPlecare').val(e.latlng.lng);
            }
            else if (!secondClick) {
                markerSosire = L.marker([e.latlng.lat, e.latlng.lng], { draggable: true });
                markerSosire.addTo(map);
                markerSosire.on('dragend', onDragendSosire);
                secondClick = true;
                $('#LatSosire').val(e.latlng.lat);
                $('#LongSosire').val(e.latlng.lng);
            }
        }
        map.on('click', onClick);
    });

</script>
